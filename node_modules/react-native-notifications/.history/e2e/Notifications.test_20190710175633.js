const Utils = require('./Utils');
const { elementByLabel, elementById } = Utils;

describe('Notifications', () => {
  // beforeEach(async () => {
  //   await device.relaunchApp({permissions: {notifications: 'YES'}});
  // });

  describe('Foreground notifications', () => {
    beforeEach(async () => {
      await device.relaunchApp({permissions: {notifications: 'YES'}});
    });
  
    it('Receive foreground notification', async () => {
      await device.sendUserNotification(createNotification('foreground/notification'));
      await expect(elementByLabel('foreground/notification')).toBeVisible();
    });
  });

  describe('Foreground notifications', () => {
    beforeEach(async () => {
      await device.relaunchApp({permissions: {notifications: 'YES'}});
    });
  
    it('Receive foreground notification', async () => {
      await device.relaunchApp({permissions: {notifications: 'YES'}, userNotification: createNotification('background/notification')});
      await expect(elementByLabel('background/notification')).toBeVisible();
    });
  });
});

function createNotification(link) {
  return {
    trigger: {
      type: 'push'
    },
    title: 'From push',
    subtitle: 'Subtitle',
    body: 'Body',
    badge: 1,
    payload: {
      appId: '14517e1a-3ff0-af98-408e-2bd6953c36a2',
      link
    }
  };
}